# Backlog

Backlog — сервис «списка хотелок» (backlog) для фильмов и сериалов. Позволяет сохранять фильмы и сериалы, добавлять
ссылку на источник просмотра, быстро выбирать, что смотреть прямо сейчас.

## Заметка от автора

> Идея создать такой сервис пришла тогда, когда накопившиеся хотелки на просмотр стали забываться в голове, слишком
> много мест где можно посмотреть тот или иной фильм/сериал, сидишь и мучаешься в попытках вспомнить.
> Добавляя ссылку на просмотр можно легко и быстро выбрать то, что подходит по настроению и перейти к просмотру. Если
> ссылка стала недоступна, то можно быстро найти по названию фильм и отредактировать.

## Текущий статус (TODO)

(Отметки соответствуют состоянию на момент создания README — обновляй чек-лист по мере прогресса.)

- [X] Поправить чтобы рейтинг был флоатом
- [X] Возможно, добавить ссылку на ресурс где можно посмотреть
- [X] Каждый фильм должен быть подписан кем был добавлен
- [X] Вывод фильмов, которые добавил текущий пользователь
- [X] Описать проект на GitHub
- [ ] Написать тесты
- [ ] Подготовить проект к выкладке на прод
- [X] Переделать Original Link на IMDB ID
- [X] Настроить логгинг
- [ ] Система подтверждения email

## Задумки на будущее
- [ ] Система уведомлений: пользователь может подписаться на уведомление когда выйдет новая серия сериала/фильма.

## Технологии

### Backend

- Python 3.13+
- FastAPI
- SQLAlchemy
- Alembic (миграции)
- PostgreSQL
- taskiq (фоновые задачи)
- Jinja2

### Frontend

- Vite + Vue
- NPM

Контейнеризация: Docker (+ docker-compose)

## Установка (локально) — с uv (UV package manager)

1. Клонируйте репозиторий:

```bash
git clone https://github.com/Nottezz/Backlog.git
cd backend
```

2. Установите зависимости через uv:

```bash
uv install
```

(Команда установит зависимости, указанные в конфигурации проекта — `pyproject.toml`.)

3. Настройте переменные окружения:

- Скопируйте шаблон и заполните значения:

```bash
cp .env.template .env
```

- Пропишите параметры БД, секреты, настройки SMTP и т.д.

4. Примените миграции (через uv-run, если вы используете uv для запуска команд, иначе вызывайте alembic напрямую):

```bash
alembic upgrade head
```

5. Запустите приложение в режиме разработки:

```bash
uvicorn app.main:app --reload
```

6. Запустите фронтенд (если есть отдельная папка frontend):

```bash
cd frontend
npm install
npm run dev
```

## Быстрый запуск с Docker

Пример (при наличии docker-compose.yml и Dockerfile):

```bash
docker-compose up --build
```

После сборки приложение доступно по адресу: http://localhost:8000

## API (общая информация)

- Базовый путь: `/api` (может быть `/`)
- Документация OpenAPI:
    - Swagger UI: `/docs`
    - ReDoc: `/redoc`

Примеры endpoint-ов:

- GET /api/movies — получить список фильмов
- POST /api/movies — добавить фильм
- GET /api/movies/{id} — получить фильм по id
- PUT /api/movies/{id} — обновить фильм
- DELETE /api/movies/{id} — удалить фильм

Пример создания фильма (curl):

```bash
curl -X POST "http://localhost:8000/api/movies" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "title": "Inception",
    "rating": 8.7,
    "imdb_id": 1375666
  }'
```

## Авторизация

- Защищённые эндпоинты требуют заголовок:
  `Authorization: Bearer <access_token>`
- Типичные эндпоинты:
    - POST /api/auth/login — получение access/refresh токенов
    - POST /api/auth/refresh — обновление access токена
    - POST /api/auth/signup — регистрация (опционально)
    - GET /api/auth/me — данные текущего пользователя

## Тестирование

- Запуск тестов:

```bash
uv run pytest tests/
```

- Запуск тестов с покрытием:

```bash
uv run pytest --cov=app tests/
```

## Вклад

1. Форкни репозиторий
2. Создай ветку: `feature/my-feature`
3. Сделай изменения и добавь тесты
4. Открой Pull Request: опиши цель изменений и план тестирования
